
* VM xml or command line:

  <qemu:commandline>
    <qemu:arg value='-gdb'/>
    <qemu:arg value='tcp::1234'/>
    <qemu:arg value='-S'/>
  </qemu:commandline>

-S is supposed to stop the kernel early, but it doesn't work that way for me.

** Also likely need this URI at the top:

<domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>



* When building kmod

  EXTRA_CFLAGS += -g -DDEBUG -O0

But heads-up -O0 doesn't work with the kernel build, at least sometimes. So I'm using
#pragma GCC optimize ("O1") in the code to dial-down optimization for the code I'm
debugging.

Also, important: I've added this to my build, right after the kmod (.ko file) is generated:

  cp tagfs.ko $KERNEL_SRC/fs/tagfs/.

Without this, gdb can't find the symbols for the kmod.

* Running gdb on the VM

  cd $KERNEL_SRC
  gdb vmlinux
  target remote :1234   # Note must match port number used with qemu
  lx-symbols            # Load symbols; may need to repeat after insmod

** Emacs gdb notes

  M-x gdb
  M-x gdb-many-windows


